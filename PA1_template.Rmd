---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading e data

```{r, echo=TRUE}
setwd("~/Dropbox/Datascience/Universite_Johns-Hopkins/Recherche_reproductible/RepData_PeerAssessment1")
activity <- read.csv("activity.csv")
```

## Preprocessing the data - Add column with time

```{r, echo=TRUE}
# convertion of intervalle and date in POSIXct
activity$time <- as.character(activity$interval)
activity$timemissingcar <- 4-nchar(activity$time)

for (i in 1:nrow(activity)) {
        if (activity$timemissingcar[i] == 1) {
                activity$time[i] <- paste("0",activity$time[i],sep = "")  
        } else if (activity$timemissingcar[i] == 2) {
                activity$time[i] <- paste("0","0",activity$time[i],sep = "")
        } else if (activity$timemissingcar[i] == 3) {
                activity$time[i] <- paste("0","0","0",activity$time[i],sep = "")
        } 
}

activity$datetime <- paste(as.POSIXct(activity$date),activity$time)
activity$datetime <- strptime(activity$datetime, "%Y-%m-%d %H%M")
activity <- activity[, - c(4:5)]

activity.complete <- activity[complete.cases(activity$steps),]

head(activity)
head(activity.complete)
```


## What is mean total number of steps taken per day?

```{r, echo=TRUE}
tapply(activity$steps,activity$date,sum)
tspd <- tapply(activity$steps,activity$date,sum)
hist(tspd, main = "Histogram of daily number of steps", density = 20,
     xlab = "Total steps per day", col = "steelblue", border = "red")
```


## What is the mean and median of steps taken per day?
```{r, echo=TRUE}
tapply(activity$steps,activity$date,mean)
tapply(activity$steps,activity$date,median)
```


## What is the average daily activity pattern?
```{r, echo=TRUE}
# Let's use activity.complete to exclude missing values
dailypattern <- tapply(activity.complete$steps,activity.complete$interval,mean)
plot(dailypattern, type = 'l')
# Index is corresponding the the 5' series : 288 * 5' every days
```


## Imputing missing values

```{r, echo=TRUE}
# Total number of missing values in the dataset
sum(is.na(activity$steps))
# Filling NA using the mean of the corresponding 5' interval
newactivity <- activity
for (i in 1:nrow(newactivity)) {
        if (is.na(newactivity$steps[i])) {
                newactivity$steps[i] <- dailypattern[as.character(newactivity$interval[i])]
        }
}
head(newactivity)
# histogram of the total number of steps taken each day


tapply(newactivity$steps,newactivity$date,sum)
newtspd <- tapply(newactivity$steps,newactivity$date,sum)
hist(newtspd, main = "Histogram of daily number of steps", density = 20,
     xlab = "Total steps per day", col = "steelblue", border = "red")

tapply(newactivity$steps,newactivity$date,mean)
tapply(newactivity$steps,newactivity$date,median)

# What is the impact of imputing missing data on the estimates of the total daily number of steps?

```



## Are there differences in activity patterns between weekdays and weekends?


```{r, echo=TRUE}
# Creating new factor variable weekday/weekend
newactivity$weekday <- "weekday"
for (i in 1:nrow(newactivity)) {
        if ((weekdays(newactivity$datetime[i]) == "Samedi") | (weekdays(newactivity$datetime[i]) == "Dimanche")) {
                newactivity$weekday[i] <- "weekend"
        }
}
newactivity$weekday <- as.factor(newactivity$weekday)
str(newactivity)

library(lattice)
#state <- data.frame(state.x77, region = state.region)
#dailypattern <- tapply(newactivity$steps,newactivity$interval,mean)


#xyplot(Life.Exp ~ Income | region, data = newactivity, layout = c(1,2))

```


